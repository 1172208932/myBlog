(this.webpackJsonptest=this.webpackJsonptest||[]).push([[0],{128:function(e){e.exports=JSON.parse('{"Snake":{"props":{"config":{"mapWidthNum":18,"mapHeightNum":18,"barrierNum":4,"boxWidth":35,"frameNumRate":15,"snakeIntLists":[{"type":"head","direction":"right","x":2,"y":1,"id":"2 1"},{"type":"body","direction":"right","x":1,"y":1,"id":"2 1"},{"type":"body","direction":"right","x":0,"y":1,"id":"2 1"}]}},"assets":[{"name":"\u98df\u7269","url":"//yun.duiba.com.cn/spark/assets/c056f05d1e43e2191e7a89b2741a52b8cdfe0af0.png","uuid":"food","ext":".png"},{"name":"\u706b\u8f66\u5934","url":"//yun.duiba.com.cn/spark/assets/21c644c3f54ec8bd31610e131e986cd5a0e9e761.png","uuid":"trainhead","ext":".png"},{"name":"\u706b\u8f66\u8282","url":"//yun.duiba.com.cn/spark/assets/d531763b04148710d6921dc6a107f4b368b8deff.png","uuid":"trainbody","ext":".png"}],"events":{"in":{"game-start":{"alias":"\u5f00\u59cb\u6e38\u620f"},"game-stop":{"alias":"\u505c\u6b62\u6e38\u620f"},"game-init":{"alias":"\u521d\u59cb\u5316\u86c7\u7684\u72b6\u6001"},"up":{"alias":"\u4e0a"},"down":{"alias":"\u4e0b"},"left":{"alias":"\u5de6"},"right":{"alias":"\u53f3"}},"out":{"GAME_OVER":{"alias":"\u6e38\u620f\u5931\u8d25"},"ADD_SORCE":{"alias":"\u5403\u5230\u98df\u7269"}}}}}')},133:function(e,t,i){e.exports=i(266)},138:function(e,t,i){},139:function(e,t,i){},144:function(e,t){},146:function(e,t){},156:function(e,t){},158:function(e,t){},185:function(e,t){},186:function(e,t){},191:function(e,t){},193:function(e,t){},200:function(e,t){},219:function(e,t){},266:function(e,t,i){"use strict";i.r(t);var n,a=i(0),r=i.n(a),s=i(126),o=i.n(s),u=(i(138),i(130)),c=(i(139),i(129)),h=i(132),d=i(131),l=i(41),f=i(42),m=i(4),p=i(128);!function(e){e.Up="up",e.Down="down",e.Left="left",e.Right="right"}(n||(n={}));var b=[{type:"head",direction:"right",x:2,y:1,id:"2 1"},{type:"body",direction:"right",x:1,y:1,id:"2 1"},{type:"body",direction:"right",x:0,y:1,id:"2 1"}],v=function(){function e(){Object(l.a)(this,e)}return Object(f.a)(e,null,[{key:"setconfig",value:function(e){var t=e.mapWidthNum,i=e.mapHeightNum,n=e.barrierNum,a=e.boxWidth,r=e.frameNumRate,s=e.snakeIntLists;this.mapWidthNum=t||18,this.mapHeightNum=i||18,this.barrierNum=n||3,this.boxWidth=a||35,this.frameNumRate=r||30,this.snakeIntLists=s||b}},{key:"initSnake",value:function(){this.snakeIntLists=[{type:"head",direction:"right",x:2,y:1,id:"2 1"},{type:"body",direction:"right",x:1,y:1,id:"2 1"},{type:"body",direction:"right",x:0,y:1,id:"2 1"}]}}]),e}(),y=function(){function e(){Object(l.a)(this,e),this.direction=n.Right,this.snakeArr=[],this.barrierArrs=new Array(v.barrierNum).fill(null),this.initSeen()}return Object(f.a)(e,[{key:"initSeen",value:function(){var e=this;this.seen=new Set,new Array(v.mapWidthNum).fill(new Array(v.mapHeightNum).fill(null)).forEach((function(t,i){t.forEach((function(t,n){e.seen.add(i+" "+n)}))}))}},{key:"getOneSeen",value:function(){return Array.from(this.seen)[Math.floor(Math.random()*Math.floor(this.seen.size))]}},{key:"beginGame",value:function(){for(var e=v.barrierNum;e;)this.addBarrier(e-1),e--;this.initSnake()}},{key:"initSnake",value:function(){var e=this;this.snakeArr=v.snakeIntLists,this.snakeArr.forEach((function(t){e.seen.delete(t.id)})),m.b.dispatchEvent("SHOW_SNAKE",{arrs:this.snakeArr})}},{key:"addBarrier",value:function(e){if(0!==this.seen.size){var t=this.getOneSeen(),i=t.split(" "),n=Number(i[0]),a=Number(i[1]),r=t;this.seen.delete(t),this.barrierArrs[e],this.barrierArrs[e]={index:e,x:n,y:a,id:r},m.b.dispatchEvent("INIT_BARRIERS",{index:e,x:n*v.boxWidth,y:a*v.boxWidth})}}},{key:"update",value:function(){this.snakeArr[0].type="body";var t=this.getnextSnakePos(this.snakeArr[0]);if(t.direction=this.direction,t.type="head",0!==this.snakeArr.filter((function(e){return(null===e||void 0===e?void 0:e.id)===t.id})).length)return e.state="die",void m.b.dispatchEvent("GAME_OVER");this.seen.delete(t.id),this.snakeArr.unshift(t);var i=this.barrierArrs.filter((function(e){return(null===e||void 0===e?void 0:e.id)===t.id}));if(0!==i.length)this.barrierArrs[i[0].index]=null,this.addBarrier(i[0].index),m.b.dispatchEvent("ADD_SORCE");else{var n=this.snakeArr.pop();this.seen.add(n.id)}m.b.dispatchEvent("SHOW_SNAKE",{arrs:this.snakeArr})}},{key:"setDirection",value:function(e){this.direction===n.Right&&e===n.Left||this.direction===n.Left&&e===n.Right||this.direction===n.Up&&e===n.Down||this.direction===n.Down&&e===n.Up||(this.direction=e)}},{key:"getnextSnakePos",value:function(e){var t=e.x,i=e.y,a={x:t,y:i,id:""};switch(this.direction){case n.Up:a.y=(i-1)%v.mapHeightNum,0===i&&(a.y=v.mapHeightNum-1);break;case n.Right:a.x=(t+1)%v.mapWidthNum;break;case n.Down:a.y=(i+1)%v.mapHeightNum;break;case n.Left:a.x=(t-1)%v.mapWidthNum,0===t&&(a.x=v.mapHeightNum-1)}return a.id=a.x+" "+a.y,a}}]),e}();y.state="alive",y.gameState="stop";var g=function(e){Object(h.a)(i,e);var t=Object(d.a)(i);function i(){var e;return Object(l.a)(this,i),(e=t.apply(this,arguments))._snakeSpriteList=[],e}return Object(f.a)(i,[{key:"_setup",value:function(){m.b.addEventListener("INIT_BARRIERS",this.setBarriers,this),m.b.addEventListener("SHOW_SNAKE",this.setSnake,this),m.b.addEventListener("ADD_SORCE",this.addSorce,this),m.b.addEventListener("GAME_OVER",this.gameOver,this),this.addEventListener(m.a.ENTER_FRAME,this.onEnterFrame,this),this._barriers=new Array(v.barrierNum).fill(null),this._map=new Array(v.mapWidthNum).fill(new Array(v.mapHeightNum).fill(0)),this._frameNum=v.frameNumRate,this.initMap(this._map),this._gameControl=new y,this._gameControl.beginGame(),console.log(m.f,"TextureCache")}},{key:"initMap",value:function(e){var t=this;e.forEach((function(e,i){e.forEach((function(e,n){var a=new m.c;a.beginFill(0,.3),a.drawRect(n*v.boxWidth,i*v.boxWidth,v.boxWidth,v.boxWidth),a.endFill(),t.addChild(a)}))}))}},{key:"setSnake",value:function(e){var t=this,i=e.data.arrs;this._snakeSpriteList.map((function(e){e.destroy()})),this._snakeSpriteList=[],i.forEach((function(e){var i=new m.e;switch(i.x=e.x*v.boxWidth+v.boxWidth/2,i.y=e.y*v.boxWidth+v.boxWidth/2,i.anchorTexture.set(.5,.5),"head"===e.type?i.texture=m.f.trainhead:i.texture=m.f.trainbody,e.direction){case n.Up:i.transform.rotation=3*Math.PI/2,i.transform.scale=new m.d((function(){}),t,1,-1);break;case n.Right:break;case n.Down:i.transform.rotation=Math.PI/2;break;case n.Left:i.transform.scale=new m.d((function(){}),t,-1,1)}t._snakeSpriteList.push(i),t.addChild(i)}))}},{key:"onEnterFrame",value:function(){"alive"===y.state&&"begin"===y.gameState&&(this._frameNum--,0===this._frameNum&&(this._frameNum=v.frameNumRate,this._gameControl.update()))}},{key:"setBarriers",value:function(e){var t=e.data,i=t.x,n=t.y,a=t.index;null!==this._barriers[a]&&(this._barriers[a].destroy(),this._barriers[a]=null);var r=new m.e;r.x=i,r.y=n,r.texture=m.f.food,this._barriers[a]=r,this.addChild(r)}},{key:"onLaunched",value:function(){v.setconfig(this.props.config),this._setup()}},{key:"onEvent",value:function(e,t){switch(e){case"game-start":this.start();break;case"game-stop":this.stop();break;case"game-init":this.init();break;case"up":case"right":case"down":case"left":this._gameControl.setDirection(e)}}},{key:"onDestroy",value:function(){this.stop(),m.b.removeEventListener("INIT_BARRIERS",this.setBarriers,this),m.b.removeEventListener("SHOW_SNAKE",this.setSnake,this),m.b.removeEventListener("ADD_SORCE",this.addSorce,this),m.b.removeEventListener("GAME_OVER",this.gameOver,this)}},{key:"start",value:function(){y.gameState="begin"}},{key:"stop",value:function(){y.gameState="stop"}},{key:"init",value:function(){y.state="alive",v.initSnake(),this._gameControl.initSnake()}},{key:"addSorce",value:function(){this.emitEvent("ADD_SORCE")}},{key:"gameOver",value:function(){this.emitEvent("GAME_OVER")}}]),i}(m.g);function k(){return new g(p["Snake"])}var E=function(){var e=Object(a.useState)(!1),t=Object(u.a)(e,2),i=t[0],n=t[1],s=Object(a.useRef)();function o(e){switch(e){case"setup":n(!0);break;case"unSetup":n(!1);break;default:s.current.emitEvent(e)}}return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"control-bar"},r.a.createElement("button",{onClick:function(e){return o("up")}},"up"),r.a.createElement("button",{onClick:function(e){return o("right")}},"right"),r.a.createElement("button",{onClick:function(e){return o("down")}},"down"),r.a.createElement("button",{onClick:function(e){return o("left")}},"left"),r.a.createElement("button",{onClick:function(e){return o("setup")}},"setup"),r.a.createElement("button",{onClick:function(e){return o("unSetup")}},"unSetup"),r.a.createElement("button",{onClick:function(e){return o("game-start")}},"start"),r.a.createElement("button",{onClick:function(e){return o("game-stop")}},"stop")),i?r.a.createElement(c.a,{ref:s,className:"canvas-widget",widgetFactory:k,onEvent:function(e,t){console.log(e,t)},onReady:function(e){console.log("CanvasWidget ready!")},onAssetsProcess:function(e,t){console.log("assets load process:".concat(e,"/").concat(t))},onAssetsComplete:function(){console.log("assets load complete")}}):null)};o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(E,null)),document.getElementById("root"))}},[[133,1,2]]]);
//# sourceMappingURL=main.86537c1a.chunk.js.map